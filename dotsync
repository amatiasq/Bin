#!/usr/bin/env bash
DOT="git --git-dir=$HOME/.dotfiles-git/ --work-tree=$HOME"
ERRORS=$($DOT pull 2>&1)

if [ $? -ne 0 ]; then
    echo 'Error running git'
    echo $ERRORS
    echo "$(date): $ERRORS" >> "$HOME/Desktop/dot.log"
    exit 1
fi

dothook disable

savegame --no-push kerbal
savegame --no-push minecraft
savegame --no-push rimworld
savegame --no-push the-cave

# Alfred & iTerm
$DOT add "$HOME/.config"
if [ -d "$HOME/.config/configstore" ]; then
    $DOT reset "$HOME/.config/configstore"
fi

# VS Code
$DOT add "$HOME/Library/Application Support/Code/User"

# Sublime Text 3
SUBLIME="$HOME/Library/Application Support/Sublime Text 3/Packages/User"
$DOT add "$SUBLIME"
if [ -d "$SUBLIME/Package Control.cache" ]; then
  $DOT reset "$SUBLIME/Package Control.cache"
fi

$DOT commit -am "Sync $(date +%d-%m-%Y) ($USER)"
$DOT push

# if $DOT commit -am "Sync $(date +%d-%m-%Y) ($USER)"; then
#   $DOT push
# fi

dothook enable
